<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon/android-chrome-256x256.png">
    <title>TGIF Loyalty</title>
  </head>
  <header>
    <!-- Navigation -->
      <nav class="navbar fixed-top navbar-expand-sm navbar-dark bg-primary" >
        <div class="container">
          <a  href="#" class="navbar-brand mb-0 h1"><img class="d-inline-block align-top" src="/images/logo.png" alt="" width="40" height="40" >
            TGIF</a>
           <!-- creamos el boton del menú para cuando se adapta a diferentes dispositivos-->    
          <button 
            type="button" 
            data-bs-toggle="collapse" 
            data-bs-target="#navbarNav" 
            class="navbar-toggler" 
            aria-controls="navbarNav" 
            aria-expanded="false" 
            aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span> <!-- aqui se pone el icono o un nombre si queremos-->
          </button>
          <!------------------------------------------------------------------------------->  
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
              <li class="nav-item">
                <a href="/index.html" class="nav-link" aria-current="page" >Home</a>
              </li>
              <li class="nav-item dropdown"> <!-- indicamos que este item va a contener otro menu-->
                <a href="#" class="nav-link dropdown-toggle" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                 Congres 117
                </a>
                <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                  <li><a href="/members.html?chamber=senate" class="dropdown-item">Senate</a></li>
                  <li><a href="/members.html?chamber=house" class="dropdown-item">House</a></li>
                </ul>
              </li>
              <li class="nav-item dropdown"> <!-- indicamos que este item va a contener otro menu-->
                <a href="#" class="nav-link dropdown-toggle" id="navbarDropdownAttendance" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                 Attendance
                </a>
                <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                  <li><a href="/attendance.html?chamber=senate" class="dropdown-item">Senate</a></li>
                  <li><a href="/attendance.html?chamber=house" class="dropdown-item">House</a></li>
                </ul>
              </li>
              <li class="nav-item dropdown"> <!-- indicamos que este item va a contener otro menu-->
                <a href="#" class="nav-link dropdown-toggle" id="navbarDropdownLoyalty" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                 Loyalty
                </a>
                <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                  <li><a href="/loyalty.html?chamber=senate" class="dropdown-item">Senate</a></li>
                  <li><a href="/loyalty.html?chamber=house" class="dropdown-item">House</a></li>
                </ul>
              </li>
            </ul>
          </div>
        </div>    
      </nav>
  </header>
<body style="background-color: beige">
  <div class="container">    
    <h1 style="margin-top: 80px;">Party Loyalty</h1>
    <p>
      Those who consider themselves to be strong partisans, strong Democrats 
      and strong Republicans respectively, tend to be the most faithful in 
      voting for their party's nominee for office and legislation that backs 
      their party's agenda.
    <h2 id="textLoyaltySenate">Senate at a Glance</h2>
    <h2 id="textLoyaltyHouse">House at a Glance</h2>
    
    <table class="table table-striped table-bordered ">
      <thead>
        <tr  style="background-color:gray">
          <th>Party</th>
          <th>Number of Reps</th>
          <th>% Voted with Party</th>
        </tr>
      </thead>
      <tbody id="myTableLoyalty">
        <tr><!-- 1ª fila -->
          <td></td>
          <td></td>
          <td></td>
        </tr>
        <tr><!-- 2ª fila -->
          <td></td>
          <td></td>
          <td></td>
        </tr>
        <tr><!-- 3ª fila -->
          <td></td>
          <td></td>
          <td></td>
        </tr>
      </tbody>
    </table>
    
    <h2><br>Least Loyal (Bottom 10% of Party)</h2>
    <table class="table table-striped table-bordered ">
      <thead>
        <tr  style="background-color:gray">
          <th>Name</th>
          <th>Number Party Votes</th>
          <th>% Party Votes</th>
        </tr>
      </thead>
      <tbody  id="tableLeastLoyal">
        <tr><!-- 1ª fila -->
          <td></td>
          <td></td>
          <td></td>
        </tr>
        <tr><!-- 2ª fila -->
          <td></td>
          <td></td>
          <td></td>
        </tr>
        <tr><!-- 3ª fila -->
          <td></td>
          <td></td>
          <td></td>
        </tr>
      </tbody>
    </table>
    <h2>Most Loyal (Top 10% of Party)</h2>
    <table class="table table-striped table-bordered ">
      <thead>
        <tr  style="background-color:gray">
          <th>Name</th>
          <th>Number Party Votes</th>
          <th>% Party Votes</th>
        </tr>
      </thead>
      <tbody id="tableMostLoyal">
        <tr><!-- 1ª fila -->
          <td></td>
          <td></td>
          <td></td>
        </tr>
        <tr><!-- 2ª fila -->
          <td></td>
          <td></td>
          <td></td>
        </tr>
        <tr><!-- 3ª fila -->
          <td></td>
          <td></td>
          <td></td>
        </tr>
      </tbody>
    </table>
    
    
 
  
    <!-- script bootstrap --------------------------------------------------------------------->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous">
    </script> 
    <script  type="module">
      import {fetchJson,calcStatistics,makeLoyalRows,makeLeastLoyalRows,makeMostLoyalRows} from './scripts/html.js';
      activeCurrentLink()
      // función para activar la página en la que estamos//
      function activeCurrentLink(){
        console.log(window.location.href)
        var element=window.document.querySelector('#navbarDropdownLoyalty') // le indicamos que estamos en Congress
        element.classList.toggle("active") 
      } 

      // debemos saber que chamber hemos puesto en la URL
      const params = new URL(document.location).searchParams;
      const chamber=params.get("chamber")
      console.log('la variable chamber es:',chamber) // le pasamos como parametro el chamber 

      selectChamberandChangetheText(chamber);  // llamamos a la función para saber que chamber hemos puesto

      function selectChamberandChangetheText(chamber){
        let file='';
        if(chamber=="house"){ // debemos coger los datos de "congress-117-house.json y ocultar texto de Senate"
          document.querySelector('#textLoyaltySenate').style.display="none";
          file="/data/congress-117-house.json";
        }
        else// debemos coger los datos de "congress-117-senate.json y ocultar texto de House"
        {
          document.querySelector('#textLoyaltyHouse').style.display="none";
          file="/data/congress-117-senate.json";
        }
        return file; // nos devuelve el fichero que debemos pasar al fetchJson
      }

      let fileJson=selectChamberandChangetheText(chamber);
             
      fetchJson(fileJson)
      .then((datos)=>{
        calcStatistics (datos); // creamos los nuevos objetos y nos calcula los miembros de cada partido
        document.querySelector('#myTableLoyalty').innerHTML=makeLoyalRows(datos) 
        document.querySelector('#tableLeastLoyal').innerHTML=makeLeastLoyalRows(datos) 
        document.querySelector('#tableMostLoyal').innerHTML=makeMostLoyalRows(datos) 
      })
    </script> 
  </div>  
</body>
</html>